// ==UserScript==
// @name         Фикс нового дизайна ВК
// @namespace    http://tampermonkey.net/
// @version      0.4
// @description  Делает изменения в новом дизайне ВКонтакте
// @author       DS27
// @match        https://vk.com/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    // Функция для скрытия элементов
    function hideElements(selector) {
        document.querySelectorAll(selector).forEach(el => {
            el.style.width = '0';
            el.style.height = '0';
            el.style.display = 'none';
        });
    }

    // Задача 1: Скрыть ненужные кнопки и бэджи
    hideElements('button.vkitBaseGallery__arrow--1CXpf');
    hideElements('span.vkitContentBadge__root--i6wr7');

    // Функция для изменения класса и стилей элементов
    function modifyCarousel() {
        document.querySelectorAll('.vkitBaseGallery__layer--JNMtq').forEach(el => {
            el.className = 'Carusel_delited';
            el.style.display = 'flex';
            el.style.flexWrap = 'wrap';

            // Подсчитываем количество дочерних элементов
            const slideCount = el.querySelectorAll('.vkitBaseGallery__slide--JhgoZ').length;

            // Устанавливаем ширину для каждого слайда в зависимости от количества
            if (slideCount <= 4) {
                el.style.flexDirection = 'row';
                el.style.alignItems = 'stretch';
                el.querySelectorAll('.vkitBaseGallery__slide--JhgoZ').forEach(slide => {
                    slide.style.width = '50%';
                    slide.style.boxSizing = 'border-box';
                });
            } else if (slideCount <= 10) {
                el.style.flexDirection = 'row';
                el.style.alignItems = 'stretch';
                el.querySelectorAll('.vkitBaseGallery__slide--JhgoZ').forEach(slide => {
                    slide.style.width = '33.33%';
                    slide.style.boxSizing = 'border-box';
                });
            }
        });
    }

    // Задача 2: Изменить класс и стили каруселей
    modifyCarousel();

    // Слушатель для динамически загружаемого контента
    new MutationObserver(() => {
        hideElements('button.vkitBaseGallery__arrow--1CXpf');
        hideElements('span.vkitContentBadge__root--i6wr7');
        modifyCarousel();

        // Задача 3: Изменить класс div с feed_wall или clear_fix feed_wall
        document.querySelectorAll('.feed_wall--no-islands, .clear_fix.feed_wall').forEach(el => {
            el.classList.remove('feed_wall--no-islands', 'clear_fix');
            el.classList.add('feed_wall');
        });
    }).observe(document.body, { childList: true, subtree: true });

    // Задача 3: Изменить класс div с feed_wall или clear_fix feed_wall
    document.querySelectorAll('.feed_wall--no-islands, .clear_fix.feed_wall').forEach(el => {
        el.classList.remove('feed_wall--no-islands', 'clear_fix');
        el.classList.add('feed_wall');
    });
})();
